{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"computation wiki page from Ming Tang \u00b6","title":"Home"},{"location":"#computation-wiki-page-from-ming-tang","text":"","title":"computation wiki page from Ming Tang"},{"location":"google-cloud/chips-gcp/","text":"Thanks Len for writing the instructions! clone the chips automator repository: \u00b6 git clone git@bitbucket.org:plumbers/chips_automator.git #NOTE: you only need to do this step once build the chips_automator conda environment and activate it: \u00b6 cd chips_automator conda env create -f chips_automator_env.yml source activate chips_automator #NOTE: you only need to do this step once Authenticate/get copy of google cloud key: \u00b6 gcloud auth application-default login #And follow the directions #NOTE: if successful, there should be a new file called ~/.ssh/google_cloud_engine #NOTE: you only need to do this step once By default, it is authenticated using Cloud SDK. To follow this, has to use a ssh authentication . Go to https://source.cloud.google.com/user/ssh_keys and copy your public key ~/.ssh/id_rsa.pub to register the key. Create a chips_automator run configuration file: \u00b6 a. copy over template: NOTE: in this example we're going to name our chips_automator conf file test.config.yaml b. Edit test.config.yaml: instance_name: define the instance name- any arbitrary string but cannon contain '.' cores: define the number of cores for the instance--default is 32 disk_size: define the size of the attached disk google_bucket_path: define the google bucket path to store the results when run is complete (optional) chips_commit: define the exact chips commit version to use samples: define the sample names and the google bucket paths to their fastqs meta: group samples into Treat/Control (i.e. input) Run chips automator: \u00b6 ./chips_automator.py -c test.config.yaml -u [ your google cloud username--usually your hostname ] -k ~/.ssh/google_cloud_enging Chips automator should run successfully, it will print diagnostic messages until it finishes. If you encounter an error, please send the output of chips automator to Len. The last output should be the ip addr of the instance. Log into the instance to check on the run: \u00b6 ssh -i ~/.ssh/google_cloud_engine [ username ] @ [ ip addr from last line of chips_automator ] cd /mnt/ssd/chips check the state of the chips run by looking at /mnt/ssd/chips/nohup.out When the run is complete or stops at an error state, don't forget to delete the instance.","title":"Run CHIPS on gcp"},{"location":"google-cloud/chips-gcp/#clone-the-chips-automator-repository","text":"git clone git@bitbucket.org:plumbers/chips_automator.git #NOTE: you only need to do this step once","title":"clone the chips automator repository:"},{"location":"google-cloud/chips-gcp/#build-the-chips_automator-conda-environment-and-activate-it","text":"cd chips_automator conda env create -f chips_automator_env.yml source activate chips_automator #NOTE: you only need to do this step once","title":"build the chips_automator conda environment and activate it:"},{"location":"google-cloud/chips-gcp/#authenticateget-copy-of-google-cloud-key","text":"gcloud auth application-default login #And follow the directions #NOTE: if successful, there should be a new file called ~/.ssh/google_cloud_engine #NOTE: you only need to do this step once By default, it is authenticated using Cloud SDK. To follow this, has to use a ssh authentication . Go to https://source.cloud.google.com/user/ssh_keys and copy your public key ~/.ssh/id_rsa.pub to register the key.","title":"Authenticate/get copy of google cloud key:"},{"location":"google-cloud/chips-gcp/#create-a-chips_automator-run-configuration-file","text":"a. copy over template: NOTE: in this example we're going to name our chips_automator conf file test.config.yaml b. Edit test.config.yaml: instance_name: define the instance name- any arbitrary string but cannon contain '.' cores: define the number of cores for the instance--default is 32 disk_size: define the size of the attached disk google_bucket_path: define the google bucket path to store the results when run is complete (optional) chips_commit: define the exact chips commit version to use samples: define the sample names and the google bucket paths to their fastqs meta: group samples into Treat/Control (i.e. input)","title":"Create a chips_automator run configuration file:"},{"location":"google-cloud/chips-gcp/#run-chips-automator","text":"./chips_automator.py -c test.config.yaml -u [ your google cloud username--usually your hostname ] -k ~/.ssh/google_cloud_enging Chips automator should run successfully, it will print diagnostic messages until it finishes. If you encounter an error, please send the output of chips automator to Len. The last output should be the ip addr of the instance.","title":"Run chips automator:"},{"location":"google-cloud/chips-gcp/#log-into-the-instance-to-check-on-the-run","text":"ssh -i ~/.ssh/google_cloud_engine [ username ] @ [ ip addr from last line of chips_automator ] cd /mnt/ssd/chips check the state of the chips run by looking at /mnt/ssd/chips/nohup.out When the run is complete or stops at an error state, don't forget to delete the instance.","title":"Log into the instance to check on the run:"},{"location":"google-cloud/wes-gcp/","text":"How to run WES pipeline in google cloud \u00b6 how to get your google cloud credentials \u00b6 a. install the gcloud sdk: (it's on conda) conda install -c conda-forge google-cloud-sdk b. Authenticate: gcloud auth login NOTE: opens up a webbrowser, where I need to select the google account to allow access c. set project: gcloud config set project cidc-biofx CREATE the new instance: \u00b6 a. Goto google cloud platform : Google Compute Engine -> click \"Create Instance\" give your instance type a unique name, e.g. wes-aashna-1 Machine type: select high-mem-64 (this has 64 cores) Boot disk: click \"Change\". click \"Custome Images\" (next to Application Images). select latest wes image-. AS OF 2019-02-04, it is wes-ver-1-1b Click \"Management, security, disks, networking, sole tenancy\". click Disks click \"Add new disk\" scroll down to size, and HERE you need to try to predict how much space you need to do your analysis e.g. 2T = 2048 scroll to the bottom, click \"Create\" NOW you will be brough back to the Google Compute Engine page click on your new instance when it is up and get the IP address login to your instance: gcloud compute ssh test-instance-1 WHERE test-instance-1 is the instance name. NOTE: this creates ~/.ssh/google_compute_engine and ~/.ssh/google_compute._engine.pub **NOTE: You only need to do this once. after ~/.ssh/google_compute_engine and ~/.ssh/google_compute._engine.pub is created, you can use this ssh cmd to log in instead: ssh -i [ your google-cloud-engine key ] [ your username ] @ [ ipaddress in 1b. ] e.g. ssh -i ~/.ssh/google_compute_engine aashna@XX.YY.ZZ.AA formatting and mounting the second drive- \u00b6 After logging in, the next step is to mount and format the drive that you apportioned in step 1.a.4 so that you can use it. a. finding the disk name: type sudo lsblk Then look for the drive name, e.g. /dev/sdb , that corresponds to the space that you called for. In most cases, it's /dev/sdb b. format the drive: type: VERY IMPORTANT-- PLEASE READ!!!! you only have to format a drive IF it is newly created. IF you are using a drive that was created from before, FORMATTING will delete everything you had from before. SO only do this once in the life of a disk! IF using an old disk, skip this step! sudo /home/taing/utils/formatDisk.sh [ drive part, e.g. 'sdb' from 2a ] e.g. sudo /home/tain/utils/formatDisk.sh sdb c. mount the drive: make a mount directory: EXAMPLE: sudo mkdir /mnt/ssd mount the drive: sudo /home/taing/utils/mountDrv.sh [ drive part, e.g. 'sdb' ] /mnt/ [ mount point from above ] Example: sudo /home/taing/utils/mountDrv.sh sdb /mnt/ssd This will mount /dev/sdb to /mnt/ssd d. create a directory you can use on /mnt/ssd : sudo mkdir /mnt/ssd/ [ username ] sudo chown [ username ] : [ username ] /mnt/ssd/ [ username ] EXAMPLE: sudo mkdir /mnt/ssd/aashna sudo chown aashna:aashna /mnt/ssd/aashna NOW you can read and write files to /mnt/ssd/aashan without being sudo e. REDIRECT /tmp NOTE: sometimes the /tmp directory can get full. To ensure this doesn't happen, I usually move /tmp off of the root partition cd /mnt/ssd #or where your newly created disk is sudo mkdir tmp sudo chmod a+w tmp sudo chmod a+r tmp soft-link cd / sudo mv tmp/ tmp.bak sudo ln -s /mnt/ssd/tmp Steps for WES setup \u00b6 f. run sentieon license: cd /home/taing/utils/ nohup ./sentieonLicense.sh & how to setup a wes run: (in the directory created in 2d.) \u00b6 change into your directory from 2d: cd /mnt/ssd/ [ username ] # clone the wes repository: git clone https://AashnaJhaveri@bitbucket.org/plumbers/cidc_wes.git # create a data directory: mkdir data # upload your fastqs into data copy out the config.yaml and metasheet.csv: cp cidc_wes/config.yaml . cp cidc_wes/metasheet.csv . Edit the config.yaml to fill the sentieon path which I believe is something: /home/taing/sentieon/sentieon.../bin fill the samples section- #Jingxin, ask aashna about this Edit metasheet.csv to define the Normal/Tumor pairs link the reference files: The reference files include, for example, the bwa index and the genome's FASTA file. ln -s /mnt/cidc_nfs/wes/ref_files Now you are ready to run RUN wes: \u00b6 source activate wes Your cmd line should be pre-pended with (wes) do a dry run to check for errors in config or metasheet snakemake -s cidc_wes/wes.snakefile -n If all is green you are good to go If there are errors, fix them FULL run: nohup time snakemake -s cidc_wes/wes.snakefile -j 64 > nohup.out & The 'nohup' allows you to log off. The 'time' will time the run for you. the -j 64 means to use 64. Use whatever number you want.","title":"Run WES on gcp"},{"location":"google-cloud/wes-gcp/#how-to-run-wes-pipeline-in-google-cloud","text":"","title":"How to run WES pipeline in google cloud"},{"location":"google-cloud/wes-gcp/#how-to-get-your-google-cloud-credentials","text":"a. install the gcloud sdk: (it's on conda) conda install -c conda-forge google-cloud-sdk b. Authenticate: gcloud auth login NOTE: opens up a webbrowser, where I need to select the google account to allow access c. set project: gcloud config set project cidc-biofx","title":"how to get your google cloud credentials"},{"location":"google-cloud/wes-gcp/#create-the-new-instance","text":"a. Goto google cloud platform : Google Compute Engine -> click \"Create Instance\" give your instance type a unique name, e.g. wes-aashna-1 Machine type: select high-mem-64 (this has 64 cores) Boot disk: click \"Change\". click \"Custome Images\" (next to Application Images). select latest wes image-. AS OF 2019-02-04, it is wes-ver-1-1b Click \"Management, security, disks, networking, sole tenancy\". click Disks click \"Add new disk\" scroll down to size, and HERE you need to try to predict how much space you need to do your analysis e.g. 2T = 2048 scroll to the bottom, click \"Create\" NOW you will be brough back to the Google Compute Engine page click on your new instance when it is up and get the IP address login to your instance: gcloud compute ssh test-instance-1 WHERE test-instance-1 is the instance name. NOTE: this creates ~/.ssh/google_compute_engine and ~/.ssh/google_compute._engine.pub **NOTE: You only need to do this once. after ~/.ssh/google_compute_engine and ~/.ssh/google_compute._engine.pub is created, you can use this ssh cmd to log in instead: ssh -i [ your google-cloud-engine key ] [ your username ] @ [ ipaddress in 1b. ] e.g. ssh -i ~/.ssh/google_compute_engine aashna@XX.YY.ZZ.AA","title":"CREATE the new instance:"},{"location":"google-cloud/wes-gcp/#formatting-and-mounting-the-second-drive-","text":"After logging in, the next step is to mount and format the drive that you apportioned in step 1.a.4 so that you can use it. a. finding the disk name: type sudo lsblk Then look for the drive name, e.g. /dev/sdb , that corresponds to the space that you called for. In most cases, it's /dev/sdb b. format the drive: type: VERY IMPORTANT-- PLEASE READ!!!! you only have to format a drive IF it is newly created. IF you are using a drive that was created from before, FORMATTING will delete everything you had from before. SO only do this once in the life of a disk! IF using an old disk, skip this step! sudo /home/taing/utils/formatDisk.sh [ drive part, e.g. 'sdb' from 2a ] e.g. sudo /home/tain/utils/formatDisk.sh sdb c. mount the drive: make a mount directory: EXAMPLE: sudo mkdir /mnt/ssd mount the drive: sudo /home/taing/utils/mountDrv.sh [ drive part, e.g. 'sdb' ] /mnt/ [ mount point from above ] Example: sudo /home/taing/utils/mountDrv.sh sdb /mnt/ssd This will mount /dev/sdb to /mnt/ssd d. create a directory you can use on /mnt/ssd : sudo mkdir /mnt/ssd/ [ username ] sudo chown [ username ] : [ username ] /mnt/ssd/ [ username ] EXAMPLE: sudo mkdir /mnt/ssd/aashna sudo chown aashna:aashna /mnt/ssd/aashna NOW you can read and write files to /mnt/ssd/aashan without being sudo e. REDIRECT /tmp NOTE: sometimes the /tmp directory can get full. To ensure this doesn't happen, I usually move /tmp off of the root partition cd /mnt/ssd #or where your newly created disk is sudo mkdir tmp sudo chmod a+w tmp sudo chmod a+r tmp soft-link cd / sudo mv tmp/ tmp.bak sudo ln -s /mnt/ssd/tmp","title":"formatting and mounting the second drive-"},{"location":"google-cloud/wes-gcp/#steps-for-wes-setup","text":"f. run sentieon license: cd /home/taing/utils/ nohup ./sentieonLicense.sh &","title":"Steps for WES setup"},{"location":"google-cloud/wes-gcp/#how-to-setup-a-wes-run-in-the-directory-created-in-2d","text":"change into your directory from 2d: cd /mnt/ssd/ [ username ] # clone the wes repository: git clone https://AashnaJhaveri@bitbucket.org/plumbers/cidc_wes.git # create a data directory: mkdir data # upload your fastqs into data copy out the config.yaml and metasheet.csv: cp cidc_wes/config.yaml . cp cidc_wes/metasheet.csv . Edit the config.yaml to fill the sentieon path which I believe is something: /home/taing/sentieon/sentieon.../bin fill the samples section- #Jingxin, ask aashna about this Edit metasheet.csv to define the Normal/Tumor pairs link the reference files: The reference files include, for example, the bwa index and the genome's FASTA file. ln -s /mnt/cidc_nfs/wes/ref_files Now you are ready to run","title":"how to setup a wes run: (in the directory created in 2d.)"},{"location":"google-cloud/wes-gcp/#run-wes","text":"source activate wes Your cmd line should be pre-pended with (wes) do a dry run to check for errors in config or metasheet snakemake -s cidc_wes/wes.snakefile -n If all is green you are good to go If there are errors, fix them FULL run: nohup time snakemake -s cidc_wes/wes.snakefile -j 64 > nohup.out & The 'nohup' allows you to log off. The 'time' will time the run for you. the -j 64 means to use 64. Use whatever number you want.","title":"RUN wes:"},{"location":"kraken/kraken_rstudio/","text":"How to Run Rstudio server on kraken \u00b6 First, submit an interactive job to get a node: srun -t 1600 --mem = 60G -c 4 --pty bash","title":"Run Rstudio on Kraken"},{"location":"kraken/kraken_rstudio/#how-to-run-rstudio-server-on-kraken","text":"First, submit an interactive job to get a node: srun -t 1600 --mem = 60G -c 4 --pty bash","title":"How to Run Rstudio server on kraken"},{"location":"setup/setup_macos/","text":"set up my new mac pro \u00b6 old post https://divingintogeneticsandgenomics.rbind.io/post/set-up-my-new-mac-laptop/ download iterm \u00b6 configure color iTerm \u2192 Preferences \u2192 Profiles \u2192 colors -> Color Presets \u2192 Tango Dark By default, word jumps (option + \u2192 or \u2190) and word deletions (option + backspace) do not work. To enable these, go to \"iTerm \u2192 Preferences \u2192 Profiles \u2192 Keys \u2192 Load Preset... \u2192 Natural Text Editing \u2192 Boom! Head explodes\" install oh-my-zsh \u00b6 sh -c \" $( curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh ) \" zsh syntax highlighting \u00b6 https://github.com/zsh-users/zsh-syntax-highlighting/blob/master/INSTALL.md Oh-my-zsh : Clone this repository in oh-my-zsh's plugins directory: git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ ZSH_CUSTOM :- ~/.oh-my-zsh/custom } /plugins/zsh-syntax-highlighting Activate the plugin in ~/.zshrc: my .zshrc has a plugin git , add it after that plugins=(git zsh-syntax-highlighting) https://github.com/zsh-users/zsh-syntax-highlighting/issues/530 shell integration \u00b6 https://iterm2.com/documentation-shell-integration.html logout and then login view images inside terminal \u00b6 put imgcat to your ~/bin . and add export PATH=$PATH:~/bin to your .zshrc https://www.iterm2.com/documentation-images.html A note on login shell and interactive shell. https://codingbee.net/rhcsa/rhcsa-starting-a-login-shell-or-interactive-shell-using-the-switch-user-su-command install conda \u00b6 conda config --add channels defaults conda config --add channels bioconda conda config --add channels conda-forge install sublime, rmate \u00b6 install R and Rstudio \u00b6","title":"set up MacOS"},{"location":"setup/setup_macos/#set-up-my-new-mac-pro","text":"old post https://divingintogeneticsandgenomics.rbind.io/post/set-up-my-new-mac-laptop/","title":"set up my new mac pro"},{"location":"setup/setup_macos/#download-iterm","text":"configure color iTerm \u2192 Preferences \u2192 Profiles \u2192 colors -> Color Presets \u2192 Tango Dark By default, word jumps (option + \u2192 or \u2190) and word deletions (option + backspace) do not work. To enable these, go to \"iTerm \u2192 Preferences \u2192 Profiles \u2192 Keys \u2192 Load Preset... \u2192 Natural Text Editing \u2192 Boom! Head explodes\"","title":"download iterm"},{"location":"setup/setup_macos/#install-oh-my-zsh","text":"sh -c \" $( curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh ) \"","title":"install oh-my-zsh"},{"location":"setup/setup_macos/#zsh-syntax-highlighting","text":"https://github.com/zsh-users/zsh-syntax-highlighting/blob/master/INSTALL.md Oh-my-zsh : Clone this repository in oh-my-zsh's plugins directory: git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ ZSH_CUSTOM :- ~/.oh-my-zsh/custom } /plugins/zsh-syntax-highlighting Activate the plugin in ~/.zshrc: my .zshrc has a plugin git , add it after that plugins=(git zsh-syntax-highlighting) https://github.com/zsh-users/zsh-syntax-highlighting/issues/530","title":"zsh syntax highlighting"},{"location":"setup/setup_macos/#shell-integration","text":"https://iterm2.com/documentation-shell-integration.html logout and then login","title":"shell integration"},{"location":"setup/setup_macos/#view-images-inside-terminal","text":"put imgcat to your ~/bin . and add export PATH=$PATH:~/bin to your .zshrc https://www.iterm2.com/documentation-images.html A note on login shell and interactive shell. https://codingbee.net/rhcsa/rhcsa-starting-a-login-shell-or-interactive-shell-using-the-switch-user-su-command","title":"view images inside terminal"},{"location":"setup/setup_macos/#install-conda","text":"conda config --add channels defaults conda config --add channels bioconda conda config --add channels conda-forge","title":"install conda"},{"location":"setup/setup_macos/#install-sublime-rmate","text":"","title":"install sublime, rmate"},{"location":"setup/setup_macos/#install-r-and-rstudio","text":"","title":"install R and Rstudio"}]}